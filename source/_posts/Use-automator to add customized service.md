---
title: 使用Mac的Automator添加自定义右键菜单
date: 2020-01-09 15:30
tags:
  - 工具
categories:
  - [生产力]
toc: true
---

平常自己有归档的习惯，使用的是坚果云来进行归档和同步。由于存储空间有限，都是使用的7z格式来进行存储，压缩比相对于zip来说比较高；但是由于7-Zip只能在Windows上使用，mac上只能使用对应的命令行（也有类似Keka的压缩软件，但是自我感觉很不方便），每次使用都要打开终端执行命令。因此就想在Finder的右键菜单中添加一个选项可以自动压缩选中的文件夹。

<!--more-->

## Automator的使用

Automator使用比较人性化，可以拖拽不同的功能组成一个流程，类似ios上的快捷指令一样。如果想要在右键菜单中添加选项，需要选中『快速操作』类型。这样创建好的操作就会自动出现在右键菜单的『服务』一栏。

<img src="https://i.loli.net/2020/01/09/nlidkC79a6pE518.png" style="zoom:50%;" />

点击『选取』就会进入到一个空白的工作流程界面。

<img src="https://i.loli.net/2020/01/09/X4c29Aywpl85NEv.png" style="zoom:50%;" />

我的目的是为了选中文件夹的时候出现『使用7z格式压缩文件夹』的选项，因此需要在上方选择`工作流程收到当前`『文件夹』`位于`『访达』。

<img src="https://i.loli.net/2020/01/09/pveT9AZFy3284H7.png" style="zoom:50%;" />这样文件夹的路径就会作为我们整个工作流程的输入。

为了执行shell脚本，我们需要在左侧的『操作』中选中『实用工具』类别，然后将该类别中的『运行Shell脚本
』拖拽到右侧。并且将右侧的『传递输入』选项改为『作为自变量』，从而使用选中的文件夹路径作为命令参数。

<img src="https://i.loli.net/2020/01/09/8eIUbJazXdTMOLQ.png" style="zoom:50%;" />

然后输入执行7z压缩的命令

```c
source ~/.zshrc
7z a -mx=7 "$@".7z -r "$@" 1>/dev/null
echo "$@".7z
```

第一行命令是要加载环境变量。在automator执行shell脚本的时候，关于路径的环境变量是不会自动加载的，这样就会在执行7z的时候产生『command not found』的错误，因此需要先执行zsh的初始化脚本。

第二行命令就是使用7z来压缩文件，命令中的a代表添加压缩文件，-mx执行压缩等级为7（最高级），$@使shell脚本中的一个特殊符号，代表传入的所有参数，在这个命令中就代表传入的文件夹路径，因此后面加上`.7z`就表示使用原有的文件夹路径。`-r`代表递归压缩子文件夹内的文件，后面跟的就是要压缩的文件夹的路径。之后的`1>/dev/null`的意思是将该命令产生的终端输出全部重定向到`/dev/null`中，也就是全部丢弃掉不予显示，至于为什么要做在下面详细解释。

至此执行完此shell命令就会产生7z压缩文件。由于Automator不支持进度条显示，因此我想在压缩完成之后自动选中该压缩文件，方便之后操作。因此还需要将『文件和文件夹』类别中的『显示访达项目』加入到流程中

<img src="https://i.loli.net/2020/01/09/MvYxaAkutpW3mRq.png" style="zoom:50%;" />

因此需要向『显示访达项目』提供产生的压缩文件的路径，而『运行Shell脚本』的输出就是实际的终端输出，所以上述的第三条命令就排上用场了。使用echo命令输出产生的压缩文件的路径，并且要在第二行命令中把7z命令产生的输出清除掉。

最后保存成『使用7z格式压缩文件夹』，保存的名称就是会出现在右键菜单中的名称。

之后在访达中选中文件夹并右键之后，该选项就会出现在『服务』一栏中。

<img src="https://i.loli.net/2020/01/09/DF7Xmzb9gfEUKMH.png" style="zoom:50%;" />
